<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuro UX Styler - AI-Powered UI Kit Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Georgia:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2DD4BF;
            --primary-dark: #14B8A6;
            --secondary: #0F172A;
            --accent: #3B82F6;
            --text: #1E293B;
            --text-light: #64748B;
            --bg: #F8FAFC;
            --white: #FFFFFF;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .header {
            background: var(--secondary);
            color: var(--white);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #E2E8F0;
        }

        .tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab:hover {
            color: var(--primary-dark);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        input, textarea, select {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary);
            color: var(--white);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .result {
            display: none;
        }

        .result.show {
            display: block;
        }

        .confidence-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .confidence-high {
            background: #D1FAE5;
            color: #065F46;
        }

        .confidence-medium {
            background: #FEF3C7;
            color: #78350F;
        }

        .confidence-low {
            background: #FEE2E2;
            color: #991B1B;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .color-item {
            text-align: center;
        }

        .color-box {
            width: 100%;
            height: 80px;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .color-box:hover {
            transform: scale(1.05);
        }

        .color-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
        }

        .color-value {
            font-size: 0.875rem;
            color: var(--text-light);
            font-family: monospace;
        }

        .typography-preview {
            padding: 2rem;
            background: #F1F5F9;
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .component-item {
            padding: 1.5rem;
            background: #F1F5F9;
            border-radius: 12px;
        }

        .component-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .component-value {
            font-size: 1rem;
            color: var(--text);
            font-weight: 500;
        }

        .feedback-section {
            background: #F1F5F9;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
        }

        .rating-stars {
            display: flex;
            gap: 0.5rem;
            font-size: 2rem;
            margin: 1rem 0;
        }

        .star {
            cursor: pointer;
            color: #CBD5E1;
            transition: color 0.2s;
        }

        .star.active,
        .star:hover {
            color: #FCD34D;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .alert {
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
        }

        .alert-success {
            background: #D1FAE5;
            color: #065F46;
        }

        .alert-error {
            background: #FEE2E2;
            color: #991B1B;
        }

        .alert-info {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            max-width: 360px;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1), opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            background: #ECFDF5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }

        .toast.error {
            background: #FEF2F2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }

        .toast.info {
            background: #EFF6FF;
            color: #1D4ED8;
            border: 1px solid #BFDBFE;
        }

        .toast .icon {
            font-size: 20px;
            line-height: 1;
        }

        .toast .close-toast {
            margin-left: auto;
            background: none;
            border: none;
            font-size: 18px;
            color: inherit;
            cursor: pointer;
            opacity: 0.7;
            padding: 4px;
            border-radius: 4px;
        }

        .toast .close-toast:hover {
            opacity: 1;
            background: rgba(0,0,0,0.05);
        }

        .export-section {
            background: linear-gradient(135deg, #F0FDF4 0%, #DBEAFE 100%);
            border: 2px dashed var(--primary);
            padding: 2rem;
            border-radius: 16px;
            margin-top: 2rem;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .export-buttons {
                flex-direction: column;
            }

            .export-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üß†</div>
        <h1>NEURO UX STYLER</h1>
        <p>AI-Powered UI Kit Generator</p>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" data-tab="generate">Generar UI Kit</button>
            <button class="tab" data-tab="stats">Estad√≠sticas</button>
        </div>

        <div id="generate" class="tab-content active">
            <div class="card">
                <h2 style="margin-bottom: 1.5rem;">Datos del Proyecto</h2>
                <form id="generateForm">
                    <div class="form-group">
                        <label for="name">Nombre del Proyecto *</label>
                        <input type="text" id="name" required placeholder="Ej: TechFlow">
                    </div>

                    <div class="form-group">
                        <label for="mission">Misi√≥n *</label>
                        <textarea id="mission" required placeholder="Describe la misi√≥n de tu proyecto..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="values">Valores (separados por comas) *</label>
                        <input type="text" id="values" required placeholder="innovaci√≥n, tecnolog√≠a, excelencia">
                    </div>

                    <div class="form-group">
                        <label for="sector">Sector *</label>
                        <select id="sector" required>
                            <option value="">Selecciona un sector</option>
                            <option value="tecnolog√≠a">Tecnolog√≠a</option>
                            <option value="salud">Salud</option>
                            <option value="finanzas">Finanzas</option>
                            <option value="educaci√≥n">Educaci√≥n</option>
                            <option value="entretenimiento">Entretenimiento</option>
                            <option value="moda">Moda</option>
                            <option value="alimentos">Alimentos</option>
                            <option value="medio ambiente">Medio Ambiente</option>
                            <option value="fitness">Fitness</option>
                            <option value="dise√±o">Dise√±o</option>
                            <option value="recursos humanos">Recursos Humanos</option>
                            <option value="ciencia">Ciencia</option>
                            <option value="movilidad">Movilidad</option>
                            <option value="transporte">Transporte</option>
                            <option value="automotriz">Automotriz</option>
                            <option value="arte">Arte</option>
                            <option value="m√∫sica">M√∫sica</option>
                            <option value="pyme">PYME</option>
                            <option value="cosm√©tica">Cosm√©tica</option>
                            <option value="agro">Agro</option>
                            <option value="legal">Legal</option>
                            <option value="judicial">Judicial</option>
                            <option value="construcci√≥n">Construcci√≥n</option>
                            <option value="ciberseguridad">Ciberseguridad</option>
                            <option value="bienestar">Bienestar</option>
                            <option value="energ√≠a">Energ√≠a</option>
                            <option value="gobierno">Gobierno</option>
                            <option value="turismo">Turismo</option>
                            <option value="ia">IA</option>
                            <option value="deportes">Deportes</option>
                            <option value="log√≠stica">Log√≠stica</option>
                            <option value="producci√≥n audiovisual">Producci√≥n Audiovisual</option>
                            <option value="medios de comunicaci√≥n">Medios de Comunicaci√≥n</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="audience">P√∫blico Objetivo *</label>
                        <input type="text" id="audience" required placeholder="Ej: Empresas B2B, j√≥venes millennials">
                    </div>

                    <button type="submit" class="btn" id="generateBtn">
                        <span id="btnText">Generar UI Kit</span>
                        <span id="btnLoading" class="loading" style="display: none;"></span>
                    </button>
                </form>
            </div>

            <div style="display: flex; gap: 1rem; margin: 2rem 0; flex-wrap: wrap;">
                <button class="btn" id="newKitSameData">
                    Generar nuevo kit con los mismos datos
                </button>
                <button class="btn btn-secondary" id="newKitNewData">
                    Nuevo proyecto
                </button>
            </div>

            <div id="result" class="result">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2>Tu UI Kit Generado</h2>
                        <span id="confidenceBadge" class="confidence-badge"></span>
                    </div>

                    <h3 style="margin-top: 2rem;">Paleta de Colores</h3>
                    <div id="colorPalette" class="color-palette"></div>

                    <h3 style="margin-top: 2rem;">Tipograf√≠a</h3>
                    <div id="typography" class="typography-preview"></div>

                    <h3 style="margin-top: 2rem;">Componentes</h3>
                    <div id="components" class="components-grid"></div>

                    <h3 style="margin-top: 2rem;">Tokens de Dise√±o</h3>
                    <div id="tokens" class="components-grid"></div>
                </div>

                <div class="card export-section">
                    <h3 style="margin-bottom: 1rem;">üì• Exportar UI Kit</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                        Descarga tu UI Kit en diferentes formatos para usar en tus proyectos
                    </p>
                    <div class="export-buttons">
                        <button class="btn" onclick="exportToCSS()">
                            üìÑ Exportar CSS Variables
                        </button>
                        <button class="btn" onclick="exportToJSON()">
                            üìã Exportar JSON
                        </button>
                        <button class="btn" onclick="exportToSCSS()">
                            üé® Exportar SCSS
                        </button>
                        <button class="btn btn-outline" onclick="exportDesignTokens()">
                            üîß Design Tokens
                        </button>
                    </div>
                </div>

                <div class="card feedback-section">
                    <h3>¬øQu√© te pareci√≥ este UI Kit?</h3>
                    <div class="rating-stars" id="ratingStars">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                    <div class="form-group">
                        <label for="feedbackText">Comentarios (opcional)</label>
                        <textarea id="feedbackText" placeholder="Cu√©ntanos qu√© mejorar√≠as..."></textarea>
                    </div>
                    <button class="btn btn-secondary" id="submitFeedback">Enviar Feedback</button>
                </div>
            </div>
        </div>

        <div id="stats" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 2rem;">Estad√≠sticas del Sistema</h2>
                <div class="stats-grid" id="statsGrid"></div>
                <div id="retrainSection" style="margin-top: 2rem;"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001';
        let currentUIKit = null;
        let selectedRating = 0;
        let lastInputData = null;

        function showToast(message, type = 'info') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="icon">${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ'}</span>
                <span>${message}</span>
                <button class="close-toast">&times;</button>
            `;

            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);

            toast.querySelector('.close-toast').addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            });

            setTimeout(() => {
                if (toast.classList.contains('show')) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(toast)) toast.remove();
                    }, 300);
                }
            }, 4000);
        }

        // ========================================
        // FUNCIONES DE EXPORTACI√ìN
        // ========================================

        function exportToCSS() {
            if (!currentUIKit) {
                showToast('No hay UI Kit para exportar', 'error');
                return;
            }

            const projectName = lastInputData?.name || 'UI Kit';
            const date = new Date().toLocaleDateString();
            
            const css = `/* ========================================
   ${projectName} - UI Kit
   Generated by Neuro UX Styler
   Date: ${date}
   Confidence: ${(currentUIKit.confidence * 100).toFixed(1)}%
   ======================================== */

:root {
  /* Colores */
  --color-primary: ${currentUIKit.colors.primary};
  --color-secondary: ${currentUIKit.colors.secondary};
  --color-accent: ${currentUIKit.colors.accent};
  --color-background: ${currentUIKit.colors.background};
  --color-text: ${currentUIKit.colors.text};
  
  /* Tipograf√≠a */
  --font-primary: '${currentUIKit.typography.primary}', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-secondary: '${currentUIKit.typography.secondary}', serif;
  
  /* Espaciado */
  --spacing-xs: ${currentUIKit.tokens.spacing.xs};
  --spacing-sm: ${currentUIKit.tokens.spacing.sm};
  --spacing-md: ${currentUIKit.tokens.spacing.md};
  --spacing-lg: ${currentUIKit.tokens.spacing.lg};
  --spacing-xl: ${currentUIKit.tokens.spacing.xl};
  
  /* Tama√±os de fuente */
  --font-size-xs: ${currentUIKit.tokens.fontSize.xs};
  --font-size-sm: ${currentUIKit.tokens.fontSize.sm};
  --font-size-md: ${currentUIKit.tokens.fontSize.md};
  --font-size-lg: ${currentUIKit.tokens.fontSize.lg};
  --font-size-xl: ${currentUIKit.tokens.fontSize.xl};
  
  /* Componentes */
  --button-radius: ${currentUIKit.components.buttonRadius};
  --card-radius: ${currentUIKit.components.cardRadius};
  --input-radius: ${currentUIKit.components.inputRadius};
  --shadow: ${currentUIKit.components.shadow};
}

/* ========================================
   Estilos Base
   ======================================== */

body {
  font-family: var(--font-primary);
  color: var(--color-text);
  background: var(--color-background);
  line-height: 1.6;
}

/* ========================================
   Componentes
   ======================================== */

/* Botones */
.btn {
  background: var(--color-primary);
  color: white;
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--button-radius);
  border: none;
  font-size: var(--font-size-md);
  font-weight: 600;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.btn-secondary {
  background: var(--color-secondary);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--color-primary);
  color: var(--color-primary);
}

/* Cards */
.card {
  background: white;
  border-radius: var(--card-radius);
  padding: var(--spacing-lg);
  box-shadow: var(--shadow);
}

/* Inputs */
.input,
input[type="text"],
input[type="email"],
textarea,
select {
  padding: var(--spacing-md);
  border-radius: var(--input-radius);
  border: 2px solid var(--color-secondary);
  font-size: var(--font-size-md);
  font-family: var(--font-primary);
  width: 100%;
  transition: all 0.3s ease;
}

.input:focus,
input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.1);
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-primary);
  font-weight: 700;
  line-height: 1.2;
}

h1 { font-size: var(--font-size-xl); }
h2 { font-size: var(--font-size-lg); }
h3 { font-size: var(--font-size-md); }

/* Links */
a {
  color: var(--color-primary);
  text-decoration: none;
  transition: opacity 0.3s ease;
}

a:hover {
  opacity: 0.8;
}
`;

            downloadFile(css, `${slugify(projectName)}-styles.css`, 'text/css');
            showToast('CSS exportado correctamente', 'success');
        }

        function exportToSCSS() {
            if (!currentUIKit) {
                showToast('No hay UI Kit para exportar', 'error');
                return;
            }

            const projectName = lastInputData?.name || 'UI Kit';
            const date = new Date().toLocaleDateString();
            
            const scss = `// ========================================
// ${projectName} - UI Kit
// Generated by Neuro UX Styler
// Date: ${date}
// Confidence: ${(currentUIKit.confidence * 100).toFixed(1)}%
// ========================================

// Colores
$color-primary: ${currentUIKit.colors.primary};
$color-secondary: ${currentUIKit.colors.secondary};
$color-accent: ${currentUIKit.colors.accent};
$color-background: ${currentUIKit.colors.background};
$color-text: ${currentUIKit.colors.text};

// Tipograf√≠a
$font-primary: '${currentUIKit.typography.primary}', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
$font-secondary: '${currentUIKit.typography.secondary}', serif;

// Espaciado
$spacing-xs: ${currentUIKit.tokens.spacing.xs};
$spacing-sm: ${currentUIKit.tokens.spacing.sm};
$spacing-md: ${currentUIKit.tokens.spacing.md};
$spacing-lg: ${currentUIKit.tokens.spacing.lg};
$spacing-xl: ${currentUIKit.tokens.spacing.xl};

// Tama√±os de fuente
$font-size-xs: ${currentUIKit.tokens.fontSize.xs};
$font-size-sm: ${currentUIKit.tokens.fontSize.sm};
$font-size-md: ${currentUIKit.tokens.fontSize.md};
$font-size-lg: ${currentUIKit.tokens.fontSize.lg};
$font-size-xl: ${currentUIKit.tokens.fontSize.xl};

// Componentes
$button-radius: ${currentUIKit.components.buttonRadius};
$card-radius: ${currentUIKit.components.cardRadius};
$input-radius: ${currentUIKit.components.inputRadius};
$shadow: ${currentUIKit.components.shadow};

// Mapas SCSS (√∫til para iteraciones)
$colors: (
  'primary': $color-primary,
  'secondary': $color-secondary,
  'accent': $color-accent,
  'background': $color-background,
  'text': $color-text
);

$spacing: (
  'xs': $spacing-xs,
  'sm': $spacing-sm,
  'md': $spacing-md,
  'lg': $spacing-lg,
  'xl': $spacing-xl
);

$font-sizes: (
  'xs': $font-size-xs,
  'sm': $font-size-sm,
  'md': $font-size-md,
  'lg': $font-size-lg,
  'xl': $font-size-xl
);

// Mixins √∫tiles
@mixin button-base {
  padding: $spacing-md $spacing-lg;
  border-radius: $button-radius;
  border: none;
  font-size: $font-size-md;
  font-weight: 600;
  cursor: pointer;
  box-shadow: $shadow;
  transition: all 0.3s ease;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }
}

@mixin card {
  background: white;
  border-radius: $card-radius;
  padding: $spacing-lg;
  box-shadow: $shadow;
}

// Estilos base
body {
  font-family: $font-primary;
  color: $color-text;
  background: $color-background;
  line-height: 1.6;
}

// Componentes
.btn {
  @include button-base;
  background: $color-primary;
  color: white;
  
  &.btn-secondary {
    background: $color-secondary;
  }
  
  &.btn-outline {
    background: transparent;
    border: 2px solid $color-primary;
    color: $color-primary;
  }
}

.card {
  @include card;
}

.input {
  padding: $spacing-md;
  border-radius: $input-radius;
  border: 2px solid $color-secondary;
  font-size: $font-size-md;
  font-family: $font-primary;
  width: 100%;
  transition: all 0.3s ease;
  
  &:focus {
    outline: none;
    border-color: $color-primary;
    box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.1);
  }
}
`;

            downloadFile(scss, `${slugify(projectName)}-styles.scss`, 'text/scss');
            showToast('SCSS exportado correctamente', 'success');
        }

        function exportToJSON() {
            if (!currentUIKit) {
                showToast('No hay UI Kit para exportar', 'error');
                return;
            }

            const projectName = lastInputData?.name || 'UI Kit';
            
            const jsonData = {
                metadata: {
                    name: projectName,
                    description: lastInputData?.mission || '',
                    sector: lastInputData?.sector || '',
                    audience: lastInputData?.audience || '',
                    generatedBy: 'Neuro UX Styler',
                    date: new Date().toISOString(),
                    confidence: currentUIKit.confidence
                },
                colors: currentUIKit.colors,
                typography: currentUIKit.typography,
                tokens: currentUIKit.tokens,
                components: currentUIKit.components
            };
            
            const json = JSON.stringify(jsonData, null, 2);
            downloadFile(json, `${slugify(projectName)}-uikit.json`, 'application/json');
            showToast('JSON exportado correctamente', 'success');
        }

        function exportDesignTokens() {
            if (!currentUIKit) {
                showToast('No hay UI Kit para exportar', 'error');
                return;
            }

            const projectName = lastInputData?.name || 'UI Kit';
            
            // Formato compatible con Style Dictionary y Figma Tokens
            const tokens = {
                "$schema": "https://schemas.opendesignsystem.org/2.0.0/design-tokens.schema.json",
                "$metadata": {
                    "name": projectName,
                    "generator": "Neuro UX Styler",
                    "generatedAt": new Date().toISOString(),
                    "confidence": currentUIKit.confidence
                },
                "color": {
                    "primary": {
                        "$value": currentUIKit.colors.primary,
                        "$type": "color",
                        "$description": "Color primario del UI Kit"
                    },
                    "secondary": {
                        "$value": currentUIKit.colors.secondary,
                        "$type": "color",
                        "$description": "Color secundario"
                    },
                    "accent": {
                        "$value": currentUIKit.colors.accent,
                        "$type": "color",
                        "$description": "Color de acento"
                    },
                    "background": {
                        "$value": currentUIKit.colors.background,
                        "$type": "color",
                        "$description": "Color de fondo"
                    },
                    "text": {
                        "$value": currentUIKit.colors.text,
                        "$type": "color",
                        "$description": "Color de texto principal"
                    }
                },
                "typography": {
                    "fontFamily": {
                        "primary": {
                            "$value": currentUIKit.typography.primary,
                            "$type": "fontFamily"
                        },
                        "secondary": {
                            "$value": currentUIKit.typography.secondary,
                            "$type": "fontFamily"
                        }
                    },
                    "fontSize": {}
                },
                "spacing": {},
                "borderRadius": {
                    "button": {
                        "$value": currentUIKit.components.buttonRadius,
                        "$type": "dimension"
                    },
                    "card": {
                        "$value": currentUIKit.components.cardRadius,
                        "$type": "dimension"
                    },
                    "input": {
                        "$value": currentUIKit.components.inputRadius,
                        "$type": "dimension"
                    }
                },
                "shadow": {
                    "default": {
                        "$value": currentUIKit.components.shadow,
                        "$type": "shadow"
                    }
                }
            };
            
            Object.entries(currentUIKit.tokens.fontSize).forEach(([key, value]) => {
                tokens.typography.fontSize[key] = {
                    "$value": value,
                    "$type": "dimension"
                };
            });
            
            Object.entries(currentUIKit.tokens.spacing).forEach(([key, value]) => {
                tokens.spacing[key] = {
                    "$value": value,
                    "$type": "dimension"
                };
            });
            
            const json = JSON.stringify(tokens, null, 2);
            downloadFile(json, `${slugify(projectName)}-design-tokens.json`, 'application/json');
            showToast('Design Tokens exportados correctamente', 'success');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function slugify(text) {
            return text
                .toString()
                .toLowerCase()
                .trim()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-');
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
                
                if (targetTab === 'stats') {
                    loadStats();
                }
            });
        });

        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const btnLoading = document.getElementById('btnLoading');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-block';
            
            const data = {
                name: document.getElementById('name').value,
                mission: document.getElementById('mission').value,
                values: document.getElementById('values').value,
                sector: document.getElementById('sector').value,
                audience: document.getElementById('audience').value
            };
            
            lastInputData = data;
            
            try {
                const response = await fetch(`${API_URL}/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUIKit = result.ui_kit;
                    displayUIKit(result.ui_kit); // ‚úÖ CORREGIDO: Esta funci√≥n ahora funciona
                    document.getElementById('result').classList.add('show');
                    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
                } else {
                    showToast(result.error, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error al conectar con el servidor', 'error');
            } finally {
                btn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        });

        // =====================================================================
        // ‚úÖ CORREGIDO: Funci√≥n displayUIKit completamente reescrita
        // =====================================================================
        function displayUIKit(data) {
            console.log('üì¶ Datos recibidos para mostrar:', data);
            
            if (!data || !data.colors || !data.typography || !data.components || !data.tokens) {
                console.error('‚ùå Error: Faltan propiedades en los datos del UI Kit:', data);
                showToast('Error: El formato de respuesta del servidor es incorrecto', 'error');
                return;
            }
            
            const confidence = data.confidence;
            const confidenceScore = (confidence * 100).toFixed(1);
            
            // 1. Badge de Confianza
            const badge = document.getElementById('confidenceBadge');
            badge.textContent = `Confianza: ${confidenceScore}%`;
            badge.className = 'confidence-badge'; // Reset class
            
            if (confidence >= 0.8) {
                badge.classList.add('confidence-high');
            } else if (confidence >= 0.5) {
                badge.classList.add('confidence-medium');
            } else {
                badge.classList.add('confidence-low');
            }
            
            // 2. Paleta de Colores
            const colorPalette = document.getElementById('colorPalette');
            colorPalette.innerHTML = '';
            Object.entries(data.colors).forEach(([name, color]) => {
                colorPalette.innerHTML += `
                    <div class="color-item">
                        <div class="color-box" style="background-color: ${color};" onclick="copyToClipboard('${color}')"></div>
                        <div class="color-label">${name}</div>
                        <div class="color-value">${color}</div>
                    </div>
                `;
            });

            // 3. Tipograf√≠a
            const typography = document.getElementById('typography');
            typography.innerHTML = `
                <div style="font-family: '${data.typography.primary}', sans-serif;">
                    <h1 style="font-family: '${data.typography.primary}', sans-serif;">Fuente Primaria (Heading): ${data.typography.primary}</h1>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                </div>
                <hr style="margin: 1.5rem 0;">
                <div style="font-family: '${data.typography.secondary}', serif;">
                    <h3 style="font-family: '${data.typography.secondary}', serif;">Fuente Secundaria (Body): ${data.typography.secondary}</h3>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                </div>
            `;
            
            // 4. Componentes
            const components = document.getElementById('components');
            components.innerHTML = '';
            Object.entries(data.components).forEach(([key, value]) => {
                components.innerHTML += `
                    <div class="component-item">
                        <div class="component-label">${key}</div>
                        <div class="component-value">${value}</div>
                    </div>
                `;
            });
            
            // 5. Tokens de Dise√±o
            const tokens = document.getElementById('tokens');
            tokens.innerHTML = '';
            Object.entries(data.tokens.spacing).forEach(([key, value]) => {
                tokens.innerHTML += `
                    <div class="component-item">
                        <div class="component-label">spacing-${key}</div>
                        <div class="component-value">${value}</div>
                    </div>
                `;
            });
            Object.entries(data.tokens.fontSize).forEach(([key, value]) => {
                tokens.innerHTML += `
                    <div class="component-item">
                        <div class="component-label">fontSize-${key}</div>
                        <div class="component-value">${value}</div>
                    </div>
                `;
            });

            // Resetear feedback
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            document.getElementById('feedbackText').value = '';
        }

        // ‚úÖ A√ëADIDO: Listener para las estrellas de rating
        document.getElementById('ratingStars').addEventListener('click', (e) => {
            if (e.target.classList.contains('star')) {
                selectedRating = parseInt(e.target.dataset.rating, 10);
                document.querySelectorAll('.star').forEach(star => {
                    star.classList.toggle('active', parseInt(star.dataset.rating, 10) <= selectedRating);
                });
            }
        });

        document.getElementById('submitFeedback').addEventListener('click', async () => {
            if (selectedRating === 0) {
                showToast('Por favor selecciona una calificaci√≥n', 'error');
                return;
            }
            
            if (!lastInputData) {
                showToast('No hay datos para enviar feedback', 'error');
                return;
            }
            
            const feedback = {
                input_data: lastInputData,
                rating: selectedRating / 5,
                feedback: document.getElementById('feedbackText').value
            };
            
            try {
                const response = await fetch(`${API_URL}/feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(feedback)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(`¬°Gracias por tu feedback! Total guardados: ${result.total_feedback}. Pendientes para reentrenar: ${result.pending_feedback}`, 'success');
                    selectedRating = 0;
                    document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
                    document.getElementById('feedbackText').value = '';
                    if (document.getElementById('stats').classList.contains('active')) {
                        loadStats();
                    }
                } else {
                    showToast(result.error || 'Error al enviar feedback', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error al enviar feedback', 'error');
            }
        });

        document.getElementById('newKitSameData').addEventListener('click', async () => {
            if (!lastInputData) {
                showToast('No hay datos para regenerar', 'error');
                return;
            }

            const btn = document.getElementById('newKitSameData');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span>Generando...</span><span class="loading" style="width:16px;height:16px;margin-left:8px;"></span>';

            try {
                const response = await fetch(`${API_URL}/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(lastInputData)
                });

                const result = await response.json();
                if (result.success) {
                    currentUIKit = result.ui_kit;
                    displayUIKit(result.ui_kit);
                    showToast('Nuevo kit generado con los mismos datos', 'info');
                } else {
                    showToast(result.error || 'Error al regenerar', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Error al regenerar el kit', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });

        document.getElementById('newKitNewData').addEventListener('click', () => {
            document.getElementById('generateForm').reset();
            document.getElementById('result').classList.remove('show');
            lastInputData = null;
            currentUIKit = null;
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            document.getElementById('feedbackText').value = '';
            document.querySelector('.tab[data-tab="generate"]').click();
        });

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.stats;
                    const totalFeedback = stats.feedback_samples + stats.pending_feedback;
                    
                    const statsGrid = document.getElementById('statsGrid');
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">Total de Datos de Entrenamiento</div>
                            <div class="stat-value">${stats.training_samples}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Feedbacks Totales</div>
                            <div class="stat-value">${totalFeedback}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Feedbacks Pendientes</div>
                            <div class="stat-value">${stats.pending_feedback}</div>
                        </div>
                    `;
                    
                    const retrainSection = document.getElementById('retrainSection');
                    if (stats.ready_for_retrain) {
                        retrainSection.innerHTML = `
                            <div class="alert alert-success">
                                ‚úÖ Tienes ${stats.pending_feedback} feedbacks nuevos. ¬°Listo para reentrenar!
                            </div>
                            <button class="btn" onclick="retrainModel()">Reentrenar Modelo</button>
                        `;
                    } else {
                        retrainSection.innerHTML = `
                            <div class="alert alert-info">
                                ‚ÑπÔ∏è Necesitas 5 feedbacks nuevos para reentrenar. Tienes ${stats.pending_feedback}.
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error al cargar estad√≠sticas:', error);
                showToast('Error al cargar estad√≠sticas', 'error');
            }
        }

        async function retrainModel() {
            const btn = document.querySelector('#retrainSection .btn');
            if (!btn) return;
            
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Reentrenando...';
            
            try {
                const response = await fetch(`${API_URL}/retrain`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                
                if (result.success) {
                    showToast(`‚úÖ Modelo reentrenado exitosamente!\n\nPrecisi√≥n: ${(result.metrics.accuracy * 100).toFixed(1)}%\nLoss: ${result.metrics.loss.toFixed(4)}\nAUC: ${result.metrics.auc.toFixed(4)}`, 'success');
                    loadStats();
                } else {
                    showToast(result.message || result.error || 'Error al reentrenar', 'error');
                }
            } catch (error) {
                console.error('Error al reentrenar:', error);
                showToast('Error al reentrenar el modelo', 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`Copiado: ${text}`, 'info');
            }).catch(err => {
                console.error('Error al copiar:', err);
                showToast('Error al copiar al portapapeles', 'error');
            });
        }

        loadStats();
    </script>
    
    </body>
</html>